# pdp11-asm

Ассемблера для архитектуры pdp11.

# Система команд


## Метки

Задаются вначале строки, и могут содержать только `_A-Z0-9`, заканчиваеться метка должна `:`, и метка не может начинаться с цифры.


## Регистры

Существует 8 регистров и 7 из них общего назначения. Обозначаются как `R0` - `R7`, `R7` - счетчик комманд, который изменяется после выполнения каждой команды автоматически.

Существует так же 8 режимов обращения к регистрам:

  0) `Rn`     - непосредственное обращение к содержимому регистру
  
  1) `@(Rn)`  - прямая адресация (по адресу в регистре)
  
  2) `(Rn)+`  - косвено-регистровая адресация 2-го уровня, с автоикрементом содержимого регистра
  
  3) `@(Rn)+` - косвено-регистровая адресация 3-го уровня, с автоикрементом содержимого регистра
  
  4) `-(Rn)`  - косвено-регистровая адресация 2-го уровня, с автодекрементом содержимого регистра
  
  5) `@-(Rn)` - косвено-регистровая адресация 3-го уровня, с автодекрементом содержимого регистра
  
  6) `X(Rn)`  - индексная адресация, итоговый адрес получается как сумма индекса (`X`) и содержимого регистра
  
  7) `@X(Rn)` - косвенно-индексная адресация, адрес получается как сумма индекса (`X`) и содержимого регистра


## Операнды

### Регистры

Регистры в командах описываются также, как представленно выше.

### Значения

Непосредственно значение можно просто записать на месте операнда, при записи значения допускается использование различных систем счисления

`0\d+` - восьмеричная

`(-)\d+` - десятичная

`0x\d+` - шеснадцатиричная

При записи значения в скобках, оно будет восприниматься как адрес (используется 3 режим для регистра `R7`)

### Метки

Также на месте операнда можно указать метку, при сборке, вместо метки подставится ее адрес.

Пока есть возможность использования только адресов меток.

## Команды

В некоторых командах содержатся модификаторы размера: `W` - операция над словом, `B` - операция над байтом.

### Одноадресные

Семантика: `<command> <operand>`

  `CLRW`, `CLRB` - обнуление операнда
  
  `INCW`, `INCB` - инкрементация
  
  `DECW`, `DECB` - декриментация
  
  ...

### Двухадресные

### Арифметические

### Дополнительные арифметические

### Операции над числами с плавающей точкой

### Команды переходов

### MARK

### SOB

### Остальные


## Секции

Семантика: `.SECTION (.CODE|.DATA|.STACK)`

Программа должна содержать минимум одну секцию с кодом.

### .CODE

Данная секция также должна содержать объявление глобальной функции (пока не используется, выполнение начинается с первой команды): `.GLOBAL LABEL_NAME`.

И в данной секции могут находиться только метки и команды.

### .DATA

Семантика данных: `<label>: <type> <value>[, <fill>]`

  `label` - используется для задания имени переменной
  
  `type` - допускаются к использованию следующие типы: `(.STRING|.BYTE|.WORD|.FLOAT|.SPACE)`
  
    `.STRING` - значение (`value`) должно содержаться в скобках, при адресации, сразу после строки подставляется нулевой байт
    
    `.SPACE` - используется совместно с `fill`, этот параметр указывает каким значение будет заполнены выделенная область
    
    `.BYTE`, `.WORD`, `.FLOAT` - целые и вещественные данные, `.FLOAT` - 4 байта

### .STACK

Нереализовано


## Дополнительная информация

Регистр букв не имеет значения.

Комментарии начинаюся с `#` в начале строки.


# Hello, World!
    
    # acd address:       0177566
    # acd check address: 0177564
    
    .SECTION .DATA
        HELLO_STR: .STRING "HELLO, WORLD!"
    
    
    .SECTION .CODE
    .GLOBAL MAIN
    
    MAIN:
        MOVW    HELLO_STR, R0
        MOVW    13,        R1
        LOOP:
            TSTB    @(R0)
            BEQ     END_LOOP
    
            MOVB    (R0)+, (0177566)
            ADC_LOOP:
                BITW    0200, (0177564)
                BEQ     ADC_LOOP
    
            SOB     R1, LOOP
        END_LOOP:
            HALT


# TO-DO

* Доработать систему меток
* Дописать README
